<!DOCTYPE html>
<html>
<head>
    <title>Time Game | HSNU 1481</title>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link href="https://www.w3schools.com/w3css/4/w3.css" rel="stylesheet">
    <link href="../css/main.css" rel="stylesheet">
    <script>
        var newRecord = false;
        // Point Functions
        if(!localStorage.timeGamePoints)
            localStorage.timeGamePoints = "0";
        var points = getPoint();
        function getPoint() {
            return parseInt(localStorage.timeGamePoints);
        }
        function addPoint(p=100) {
            localStorage.timeGamePoints = String(parseInt(localStorage.timeGamePoints) + p);
            points = getPoint();
        }
        if(!localStorage.timeGameRecord)
            localStorage.timeGameRecord = "-";
        function Record(r) {
            if(localStorage.timeGameRecord == "-" || r < parseInt(localStorage.timeGameRecord)) {
                localStorage.timeGameRecord = r;
                newRecord = true;
            }
        }
    </script>
    <style>
        .gameContainer {
            zoom: 1.2;
        }
        #timeGame {
            font-size: 6rem;
        }
        @media screen and (max-width: 600px){
            #timeGame {
                font-size: 5rem;
            }
        }
    </style>
</head>
<body>
    <div class="content">
        <!-- Navigation -->
        <div class="w3-bar w3-border-bottom">
            <a class="w3-bar-item w3-button" href="/"><span style="color: black !important; word-spacing: 1px;">HSNU</span> <b class="BlueGradient" style="color: royalblue;">1481</b></a> <a class="w3-bar-item w3-button w3-text-black" href="/news">新聞</a> <a class="w3-bar-item w3-button w3-text-black" href="/curriculum">課表</a> <a class="w3-bar-item w3-button w3-text-black" href="/forum">論壇</a> <a class="w3-bar-item w3-button w3-text-black" href="/product">產品</a>
        </div>
        <div class="w3-container w3-center gameContainer">
            <h2>Your Points: <span id="p"></span></h2>
            <h3>Best Record: <span id="r"></span></h3>
            <button class="w3-button w3-round w3-border w3-margin-bottom" id="timeGame">TIME</button><br>
            <button class="w3-button w3-round w3-border" id="button">Restart</button>
        </div>
    </div>
    <div class="footer w3-container w3-white">
        <span>Copyright © 2019 HSNU <b class="BlueGradient" style="color: royalblue;">1481</b>.<br>
        All rights reserved.</span>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8">
    </script> 
    <script>
        var game = {
            "s_time": 0
        };
        var tg = document.getElementById("timeGame");
        var p = document.getElementById("p");
        var r = document.getElementById("r");
        var button = document.getElementById("button");
        tg.onclick = function(){check()};
        button.onclick = function(){clearInterval(game.timer);start()};
        p.innerHTML = points;
        r.innerHTML = localStorage.timeGameRecord + " ms";
        Swal.fire("Warning", "This game is very difficult.<br>Please don't be mad if you lose.", "warning").then(function(){start()});
        function start() {
            var g = game;
            var d = Date.now();
            var l = parseInt(1000 + Math.random()*4000);
            g.s_time = d + l;
            g.started = true;
            g.timer = setInterval(function() {
                let dd = game.s_time - Date.now();
                tg.innerHTML = (dd > 0) ? dd : -dd;
                tg.style.color = (dd > 0) ? "blue" : "orange";
            }, 2);
        }
        function check() {
            if(game.started == false)
                return;
            clearInterval(game.timer);
            game.started = false;
            var dd = 500 - parseInt(tg.innerHTML);
            Record(parseInt(tg.innerHTML));
            var gp = (dd > 0) ? parseInt(dd/5) : 0;
            addPoint(gp);
            p.innerHTML = points;
            Swal.fire("Finished", "You got " + gp + " point" + ((gp>1)?"s":""), ((dd > 0) ? "success" : "error")).then(function(){
                if(newRecord) {
                    Swal.fire("New Record!", "New Best Record: " + localStorage.timeGameRecord + " ms", "success");
                    r.innerHTML = localStorage.timeGameRecord + " ms";
                    newRecord = false;
                }
            });
        }
    </script>
</body>
</html>