<html>
<head>
    <title>新聞 | HSNU 1481</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link href="../css/main.css" type="text/css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="師大附中1481班 新聞">
    <link rel="icon" href="../icon.jpg" type="image/ico"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="../icon.jpg">
    <link rel="apple-touch-startup-image" href="../icon.jpg">
    <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-firestore.js"></script>
    <script>
        var config = {
            apiKey: "AIzaSyAW060kfFPzaSKzflp9eXesmyn-GMYj-M8",
            authDomain: "hsnu-1481-website.firebaseapp.com",
            databaseURL: "https://hsnu-1481-website.firebaseio.com",
            projectId: "hsnu-1481-website",
            storageBucket: "hsnu-1481-website.appspot.com",
            messagingSenderId: "405025421965"
        };
        firebase.initializeApp(config);
        var db = firebase.firestore();
    </script>
    <style>
        .News {
            max-width: 600px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="content">
        <!-- Navigation -->
        <div class="w3-bar w3-border-bottom">
            <a class="w3-bar-item w3-button" href="/"><span style="color: black !important; word-spacing: 1px;">HSNU</span> <b class="BlueGradient" style="color: royalblue;">1481</b></a> <a class="w3-bar-item w3-button w3-text-black" href="/news">新聞</a> <a class="w3-bar-item w3-button w3-text-black" href="/curriculum">課表</a> <a class="w3-bar-item w3-button w3-text-black" href="/forum">論壇</a> <a class="w3-bar-item w3-button w3-text-black" href="/product">產品</a>
        </div>
        <div class="w3-container w3-center">
            <h1 id="title">NEWS</h1>
            <div class="TodayNews w3-margin-top w3-margin-bottom">
            </div>
        </div>
    </div>
    <div class="footer w3-container w3-white">
        <span>Copyright © 2019 HSNU <b class="BlueGradient" style="color: royalblue;">1481</b>.<br>
            All rights reserved.</span>
    </div>
    <script>
        var news = {totalResults: 0, articles: []};
        if(localStorage["NewsCachedTime"] + 60*60*1000 > Date.now()) {
        news = JSON.parse(localStorage["NewsCache"]);
        placeNews();
        }
        else fetchNews();
        
        function fetchNews() {
            db.collection("NEWS").orderBy("Time", "desc").limit(6).get().then(function(querySnapshot) {
                querySnapshot.forEach(function(doc) {
                    var article = doc.data();
                    news.totalResults++;
                    news.articles.push({
                        urlToImage: article.Image,
                        title: article.Title,
                        description: article.Content,
                        author: article.Author,
                        time: article.Time.toDate().toLocaleString()
                    });
                    console.log(doc.id, " => ", doc.data());
                })
            }).then(()=>placeNews());
        }
        function placeNews() {
            if(!news.totalResults) {
                document.getElementsByClassName("TodayNews")[0].innerHTML = "最近沒有發布任何新聞";
                return;
            }
            for(var i = 0; i < news.totalResults; i++) {
                var newsContainer = document.createElement("div");
                var newsImage = document.createElement("img");
                var newsInfo = document.createElement("div");
                var newsTitle = document.createElement("h3");
                var newsDescription = document.createElement("p");
                var wrapper = document.createElement("div");
                
                newsContainer.classList.add("w3-round-large", "w3-border", "w3-margin", "News");
                newsContainer.style.overflow = "hidden";
                newsImage.src = news.articles[i].urlToImage || "";
                newsImage.style.width = "100%";
                newsImage.style.objectFit = "cover";
                newsImage.style.objectPosition = "top";
                newsImage.style.maxHeight = "400px";
                newsInfo.classList.add("w3-container");
                newsTitle.style.fontSize = "1.4rem";
                newsTitle.innerHTML = news.articles[i].title;
                newsDescription.innerHTML = news.articles[i].description;
                
                newsInfo.appendChild(newsTitle);
                newsInfo.appendChild(newsDescription);
                newsContainer.appendChild(newsImage);
                newsContainer.appendChild(newsInfo);
                wrapper.appendChild(newsContainer);
                document.getElementsByClassName("TodayNews")[0].appendChild(wrapper);
            }
        }
    </script>
</body>
</html>
